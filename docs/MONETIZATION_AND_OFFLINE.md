# Монетизация и офлайн-режим

## 1. Возможности для монетизации приложения

- **Подписка (премиум)**  
  Часть функций только по подписке: например, экспорт в PDF, расширенная статистика, напоминания, снятие лимита записей. Реализация: проверка подписки на бэкенде или через Store (In-App Purchase). В Supabase можно хранить флаг `subscription_active` или использовать Stripe/RevenueCat.

- **Разовая покупка**  
  Пользователь один раз платит и получает доступ к премиум-функциям навсегда. Проще подписки с точки зрения логики, но доход однократный.

- **Freemium**  
  Базовый функционал бесплатно (трекер веса, базовая статистика), расширенные отчёты, несколько целей, синхронизация на несколько устройств — за деньги или по подписке.

- **Реклама**  
  Баннеры или полноэкранная реклама (AdMob) в бесплатной версии. Минус — ухудшение UX; плюс — доход без обязательной оплаты от пользователя.

- **Донаты**  
  Кнопка «Поддержать разработчика» (разовая или подписка через Store). Не блокирует функционал, подходит как дополнение к бесплатной версии.

- **Корпоративные лицензии / B2B**  
  Платная версия для клиник, фитнес-клубов с отчётами и мультипользователем. Обычно отдельный контракт и цены.

Для первого релиза чаще всего делают бесплатное приложение + одна модель: либо подписка, либо разовая покупка, либо реклама.

**Подписка с пробным периодом (3 дня, далее месяц/год)**  
Одна только настройка в App Store / Google Play недостаточна. Нужно и в коде, и в кабинетах магазинов:

- **В App Store Connect / Google Play Console:** создать товары подписки (пробный период 3 дня, месячная и годовая подписки), указать цены и связь с приложением.
- **В приложении:** подключить покупки (например, `expo-in-app-purchases` или `react-native-iap`), при старте или при входе в премиум-функции запрашивать статус подписки (активна ли, есть ли триал), показывать экран подписки/пробного периода, после покупки сохранять факт доступа (локально и/или на бэкенде).
- **На бэкенде (по желанию):** проверять чеки от Apple/Google (или использовать сервис вроде RevenueCat), хранить флаг «подписка активна» по user_id, чтобы ограничивать доступ к премиум-функциям и с нескольких устройств.

Итого: «только в App Store» не хватит — без кода приложение не будет знать, купил ли пользователь подписку и показывать экран входа в пробный период или оплаты.

---

## 2. Офлайн-работа приложения

**Как это обычно делают**

- Данные при отсутствии сети пишутся и читаются из **локального хранилища** (кэш приложения): SQLite или AsyncStorage/MMKV. При появлении интернета изменения **синхронизируются** с Supabase (отправка отложенных записей, подтягивание свежих данных).
- То есть данные действительно хранятся в «кэше» приложения (локальная БД или ключ-значение), а не только в облаке.

**Что нужно сделать по шагам**

1. **Локальная база или хранилище**  
   Варианты:
   - **SQLite** (например, expo-sqlite) — полноценная БД на устройстве: таблицы `entries`, `users` (копия), очередь отложенных операций.
   - **AsyncStorage + JSON** — проще: сохранять список записей и профиль в виде строки, при запуске читать и при наличии сети сливать с Supabase.

2. **Правила записи**  
   - При добавлении/редактировании/удалении записи: сначала писать в локальное хранилище и помечать «не синхронизировано» (например, флаг `pending_sync`).
   - Показывать пользователю данные из локального хранилища (чтобы всё работало без интернета).

3. **Синхронизация при появлении сети**  
   - Слушать состояние сети (например, `@react-native-community/netinfo`).
   - Когда сеть есть: отправлять отложенные операции в Supabase (вставки, обновления, удаления), затем подтягивать актуальные данные и обновлять локальный кэш.
   - Разрешать конфликты (одна и та же запись изменена и локально, и в облаке): по дате изменения или «последнее выигрывает».

4. **Авторизация**  
   - Вход/регистрация требуют сети. После входа можно сохранять сессию (Supabase уже использует AsyncStorage для токенов) и в офлайне разрешать только работу с данными под уже залогиненным пользователем.

**Насколько это сложно**

- **Простой вариант (только чтение офлайн):** при загрузке данных с Supabase дублировать их в AsyncStorage; при отсутствии сети показывать последние загруженные данные. Реализуется за 1–2 дня.
- **Полноценный офлайн (запись + синхронизация):** очередь операций, конфликты, обновление локальной БД — уже средняя сложность, несколько дней работы и тестирования. Для первого релиза можно не делать, а добавить позже.

Итого: офлайн делается за счёт хранения данных в кэше приложения (локальная БД или AsyncStorage) и последующей синхронизации с Supabase при появлении сети. Сложность зависит от того, нужен ли только просмотр последних данных или полное редактирование офлайн с синхронизацией.
