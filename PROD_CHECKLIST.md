# Чеклист перед выпуском в прод и шаги публикации

## 1. Уязвимости и безопасность

- **Секреты:** Ключи Supabase уже берутся из .env (EXPO_PUBLIC_*), .env в .gitignore — в репозиторий не попадают. В прод-сборке подставляй переменные в EAS (см. ниже), в код не коммить.
- **RLS в Supabase:** Обязательно включи Row Level Security для таблиц `users` и `entries` и настрой политики (только свой id / user_id). Без этого пользователи могут видеть чужие данные. Скрипты в SUPABASE_RLS_SETUP.sql.
- **Anon key в клиенте:** Для Supabase это нормально: anon key публичный, доступ к данным ограничивается RLS. Service role key в приложение не класть.
- **Ввод пользователя:** В онбординге и добавлении записей есть проверки диапазонов — хорошо. Имеет смысл дополнительно проверять дату (не из будущего) и при сохранении записи — нет ли уже записи на эту дату (предложить обновить или отменить).

## 2. Что могло быть упущено

- **Колонка name в users:** Если ещё не добавляла — выполни в Supabase: `ALTER TABLE users ADD COLUMN name TEXT;`
- **Политика конфиденциальности и оферта:** Для публикации в сторах понадобятся ссылки на политику конфиденциальности и пользовательское соглашение (хостинг на сайте или GitHub Pages).
- **Экран загрузки/ошибки:** При долгой загрузке или обрыве сети пользователь видит только "Загрузка..." или Alert. Можно добавить экран "Нет интернета" и кнопку "Повторить".
- **Выход из аккаунта:** Есть ли в профиле кнопка "Выйти" и вызывается ли signOut — проверь сценарий повторного входа.

## 3. Чего может не хватать в приложении

- **Восстановление пароля:** Ссылка "Забыли пароль?" на экране входа и обработка сброса через Supabase (у тебя уже есть resetPasswordForEmail).
- **Редактирование профиля:** Возможность поменять имя, цель, темп и т.д. в профиле (частично уже есть).
- **Одна запись на дату:** Чтобы не было двух записей веса на один день — при добавлении проверять дату и предлагать обновить существующую запись.
- **Обработка истёкшей сессии:** При долгом неиспользовании приложения токен может истечь — при 401/403 перенаправлять на экран входа.
- **Офлайн:** Пока нет — при отсутствии сети запросы падают. Для первого релиза можно оставить как есть и показывать сообщение "Нет интернета".

## 4. Что улучшить

- **Error Boundary:** Обернуть приложение в компонент, который ловит ошибки рендера и показывает "Что-то пошло не так" + кнопку "Попробовать снова", чтобы приложение не падало белым экраном.
- **Защита от двойного нажатия:** На кнопках "Сохранить"/"Зарегистрироваться" отключать кнопку на время запроса (loading уже есть — убедись, что кнопка disabled при loading).
- **Валидация даты:** Не разрешать дату из будущего при добавлении записи.
- **Читаемые сообщения об ошибках:** Уже используется getAuthErrorMessage — хорошо. Проверить, что везде показывается понятный текст, а не сырой error.message от API.

## 5. Шаги, чтобы выпустить приложение в прод и чтобы его могли скачать

Ниже — по шагам, без лишних деталей.

### Шаг 1. Аккаунты и инструменты

- **Apple Developer** (для iOS): 99 USD/год. Регистрация на developer.apple.com. Нужна для публикации в App Store.
- **Google Play Console** (для Android): 25 USD один раз. Регистрация на play.google.com/console. Нужна для публикации в Google Play.
- **Expo (EAS):** У тебя уже Expo. Для сборки под прод нужен EAS Build. Выполни в проекте: `npm install -g eas-cli`, затем `eas login` (аккаунт Expo).

### Шаг 2. Настроить проект под EAS

В корне проекта:

```bash
eas build:configure
```

Создастся файл `eas.json`. Для прод-сборок обычно используют профиль `production`: туда задаётся окружение (production) и при необходимости переменные.

### Шаг 3. Переменные окружения для прод-сборки

Секреты в открытый репозиторий не класть. Задай их в EAS:

- В браузере: expo.dev → твой проект → Settings → Secrets.
- Добавь секреты: `EXPO_PUBLIC_SUPABASE_URL` и `EXPO_PUBLIC_SUPABASE_ANON_KEY` со значениями для прод-проекта Supabase.

Либо через CLI:

```bash
eas secret:create --name EXPO_PUBLIC_SUPABASE_URL --value "https://твой-проект.supabase.co"
eas secret:create --name EXPO_PUBLIC_SUPABASE_ANON_KEY --value "твой_anon_key"
```

При сборке EAS подставит их в приложение.

### Шаг 4. Иконки и название

В `app.json` уже указаны имя, slug, иконки (icon, adaptive-icon, splash). Проверь:

- В папке `assets` есть `icon.png`, `adaptive-icon.png`, `splash-icon.png` (и при необходимости favicon для web).
- Название и slug те, под которыми хочешь публиковать приложение.

Если в консоли были ошибки про `assets/icon.png` — убедись, что файл существует или поправь путь в `app.json`.

### Шаг 5. Сборка установочных файлов

- **iOS (для App Store):**  
  ```bash
  eas build --platform ios --profile production
  ```  
  Сборка идёт в облаке Expo. В конце получишь ссылку на .ipa или уведомление о готовности в кабинете Expo. Для загрузки в App Store нужен именно production-профиль (подписанный архив).

- **Android (для Google Play):**  
  ```bash
  eas build --platform android --profile production
  ```  
  Получишь .aab (рекомендуется для Play) или .apk. Для публикации в маркет обычно используют .aab.

Первый раз EAS может спросить про Apple/Google аккаунты и сертификаты — пройди шаги в инструкциях в терминале или в документации EAS.

### Шаг 6. Публикация в магазины

**App Store (iOS):**

1. В кабинете Apple Developer создай приложение (App ID, название).
2. В App Store Connect создай новое приложение, укажи название, категорию, загрузи описание, скриншоты, иконку, ссылку на политику конфиденциальности.
3. Через EAS или Xcode загрузи собранный .ipa как новую версию (например, через `eas submit` или Transporter).
4. Отправь сборку на ревью. После одобрения можно выставить в продажу.

**Google Play (Android):**

1. В Play Console создай новое приложение.
2. Заполни описание, скриншоты, контент-рейтинг, политику конфиденциальности.
3. В разделе "Release" создай релиз и загрузи .aab из EAS.
4. Отправь на проверку. После одобрения приложение можно опубликовать.

### Шаг 7. Что подготовить для магазинов

- Краткое и полное описание приложения на русском (и при необходимости на английском).
- Скриншоты телефона (обычно 2–8 штук) для разных размеров экранов.
- Иконка приложения (уже есть в проекте).
- Ссылка на политику конфиденциальности (обязательно).
- Ссылка на пользовательское соглашение (часто обязательна).
- Для Apple: при необходимости указать, что приложение не собирает данные или какие данные собирает (логин/пароль через Supabase и т.д.).

### Шаг 8. После первой публикации

- Следить за отзывами и крашами в консолях Apple/Google.
- При обновлениях: поднять версию в `app.json` (version и для iOS buildNumber, для Android versionCode), заново собрать через EAS и загрузить новую сборку в магазин.

Кратко: настроил RLS и секреты → собрал через EAS Build → загрузил в App Store Connect и Google Play Console → заполнил карточку приложения и отправил на модерацию → после одобрения приложение смогут скачать.
